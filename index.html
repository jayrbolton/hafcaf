<head>
  <script type="text/javascript" src="monkeypatch.js"></script>
<style type="text/css">

  body {
    background: #222;
    font-family: Helvetica, Open Sans, sans-serif;
    color: white;
  }

</style></head>
<body>
  
  
  <div style="text-align: center;padding: 2rem;">

  <div style="font-size: 2.5rem;padding: 1rem;margin: 1rem;"><button style="background: #444;color: white;font-size: 2rem;padding: 1rem;border: 1px solid white;outline: none;cursor: pointer;" _add_caffeine_btn="">+ Record new caffeine consumption</button></div><div style="font-size: 2.5rem;padding: 1rem;">Current caffeine level:</div><div _total_mg="" style="font-size: 4rem;padding: 1rem;font-weight: bold;">10mg</div>

</div>


<script type="text/javascript" _custom_script="">(function() {
  window._state = localStorage.getItem('_state');
  function saveState() {
    localStorage.setItem("_state", JSON.stringify(window._state));
  }
  window._resetState = function () {
    window._state = {
      totalMg: 0,
      history: [],
    };
    localStorage.setItem("_state", JSON.stringify(window._state));
  }
  if (window._state) {
    try {
      window._state = JSON.parse(window._state);
    } catch(err) {
      console.error("Error loading state: " + err);
      throw err;
    }
  } else {
    window._resetState();
  }
  // Initialize the _total_mg component
  const totalMgEl = document.querySelector("[_total_mg]");
  function consumeCaffeine(amount) {
    window._state.history.push({
      amount,
      time: Number(new Date()),
    });
    window._state.totalMg = window._state.history.reduce((sum, hist) => sum + hist.amount, 0);
    saveState();
    totalMgEl.textContent = window._state.totalMg + "mg";
  }
  consumeCaffeine(window._state.totalMg);
  // Initialize the caffeine add button component
  const addCaffeineBtn = document.querySelector("[_add_caffeine_btn]");
  addCaffeineBtn.addEventListener('click', function (ev) {
    // Increment total mg by 5
    consumeCaffeine(5);
  });
  // Decrement caffeine level based on half-life
  setInterval(function () {
    window._state.history = window._state.history.map((hist) => {
    });
  }, 5000)
})();</script></body>